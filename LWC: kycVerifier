import { LightningElement, track } from 'lwc';
import runKyc from '@salesforce/apex/KycController.runKyc';
import { ShowToastEvent } from 'lightning/platformShowToastEvent';

export default class KycVerifier extends LightningElement {
  @track form = { firstName: '', lastName: '', ssn: '', dob: '' };
  @track result;
  @track loading = false;

  handleChange(e) {
    this.form = { ...this.form, [e.target.name]: e.target.value };
  }

  async handleVerify() {
    this.loading = true;

    try {
      const res = await runKyc({ req: this.form });
      this.result = res;

      if (res.status === 'ERROR') {
        this.showToast('KYC Error', res.reason, 'error');
      }

    } catch (err) {
      this.showToast('Unexpected Error', err.body?.message || err.message, 'error');
    } finally {
      this.loading = false;
    }
  }

  showToast(title, message, variant) {
    this.dispatchEvent(
      new ShowToastEvent({
        title,
        message,
        variant
      })
    );
  }
}
